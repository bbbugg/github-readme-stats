name: Upstream Sync

permissions:
  contents: write
  issues: write
  actions: write

on:
  # æ¯2å°æ—¶è¿è¡Œä¸€æ¬¡
  schedule:
    - cron: '0 12 * * *'
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  sync_latest_from_upstream:
    name: Sync latest commits from upstream repo
    runs-on: ubuntu-latest
    # ç¡®ä¿è¿™æ˜¯ä¸€ä¸ª fork ä»“åº“
    # if: ${{ github.event.repository.fork }}

    steps:
      # æ­¥éª¤1: æ£€å‡ºä½ çš„ä»“åº“ä»£ç 
      - name: Checkout target repo
        uses: actions/checkout@v4

      # æ­¥éª¤2: æ¸…ç†ä¹‹å‰å¯èƒ½å­˜åœ¨çš„å¤±è´¥é€šçŸ¥ Issue
      - name: Clean issue notice
        uses: actions-cool/issues-helper@v3
        with:
          actions: 'close-issues'
          labels: 'ğŸš¨ Sync Fail'

      # æ­¥éª¤3: åŒæ­¥ä¸Šæ¸¸ä»“åº“çš„å˜æ›´
      - name: Sync upstream changes
        id: sync
        uses: aormsby/Fork-Sync-With-Upstream-action@v3.4
        with:
          # å…³é”®ä¿®æ”¹ç‚¹ 1: ä¸Šæ¸¸ä»“åº“åœ°å€
          upstream_sync_repo: anuraghazra/github-readme-stats
          
          # å…³é”®ä¿®æ”¹ç‚¹ 2: ä¸Šæ¸¸ä»“åº“çš„åˆ†æ”¯
          upstream_sync_branch: master
          
          # å…³é”®ä¿®æ”¹ç‚¹ 3: ä½ çš„ä»“åº“è¦åŒæ­¥çš„åˆ†æ”¯
          target_sync_branch: master
          
          # æ— éœ€ä¿®æ”¹: ä½¿ç”¨ GitHub è‡ªåŠ¨ç”Ÿæˆçš„ Token
          target_repo_token: ${{ secrets.GITHUB_TOKEN }}
          
          # è®¾ç½®ä¸º false ä»¥å®é™…æ‰§è¡ŒåŒæ­¥
          test_mode: false

      # æ­¥éª¤4: å¦‚æœåŒæ­¥å¤±è´¥ï¼Œåˆ›å»ºä¸€ä¸ª Issue è¿›è¡Œæé†’
      - name: Create issue on sync failure
        if: failure()
        uses: actions-cool/issues-helper@v3
        with:
          actions: 'create-issue'
          title: 'ğŸš¨ åŒæ­¥å¤±è´¥ | Sync Fail'
          labels: 'ğŸš¨ Sync Fail'
          # å…³é”®ä¿®æ”¹ç‚¹ 4: æ›´æ–°å¤±è´¥æç¤ºä¿¡æ¯
          body: |
            è‡ªåŠ¨åŒæ­¥ä¸Šæ¸¸ä»“åº“ [anuraghazra/github-readme-stats](${upstream_repo_url}) æ—¶å‘ç”Ÿé”™è¯¯ã€‚

            è¿™å¯èƒ½æ˜¯å› ä¸ºä¸Šæ¸¸ä»“åº“çš„ workflow æ–‡ä»¶å‘ç”Ÿäº†å˜æ›´ï¼Œå¯¼è‡´ GitHub è‡ªåŠ¨æš‚åœäº†è®¡åˆ’ä»»åŠ¡ã€‚
            
            è¯·æ£€æŸ¥ Actions æ—¥å¿—ä»¥è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼Œå¹¶è€ƒè™‘æ‰‹åŠ¨åŒæ­¥ä¸€æ¬¡æ¥è§£å†³é—®é¢˜ã€‚

            [upstream_repo_url]: https://github.com/anuraghazra/github-readme-stats
